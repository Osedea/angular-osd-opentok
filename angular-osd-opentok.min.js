"use strict";!function(){angular.module("osdOpentok",[])}(),function(){function e(e){e.put("/templates/angular-osd-opentok.html",'<div id="opentokDiv" class="video-block"><div class="subscriber-list"><div id="subscriber-{{ $index + 1 }}"ng-repeat="subscriber in getSubscribers()"ng-class="subscriber.isFullscreen ? \'main-subscriber\' : \'thumbnail-subscriber\'"ng-click="switchFullscreen(subscriber)"ng-style="subscriber.getStyle()"></div></div><div id="publisherDiv"ng-show="showPublisherTile"ng-class="{ \'fullscreen\' : publisher.isFullscreen }"class="publisher"></div><div class="dropup"><button class="btn btn-primary" type="button" id="dropdownMenu2" data-toggle="dropdown"aria-expanded="true">Users ( {{ getStreamsAvailable().length + 1 }} ) <span class="caret"></span></button><ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2"><li><a ng-click="showPublisherTile = !showPublisherTile"ng-disabled="isSubscribing() && !isBeingSubscribedTo(stream)"><span>You</span><div class="pull-right"><i class="fa" ng-class="showPublisherTile ? \'fa-compress\' : \'fa-expand\'"></i></div></a></li><li ng-repeat="stream in getStreamsAvailable()"><a ng-click="isBeingSubscribedTo(stream) ? forceDisconnect(stream) : subscribe(stream)"ng-show="isModerator"><span>{{ stream.name }}</span><div class="pull-right"><i class="fa" ng-class="isBeingSubscribedTo(stream) ? \'fa-stop\' : \'fa-play\'"></i></div></a></li></ul></div></div>')}e.$inject=["$templateCache"],angular.module("osdOpentok").run(e)}(),function(){var e=angular.module("osdOpentok");e.provider("OpentokConfig",function(){var e=this,n={maxVideoSubscribers:2,maxAudioSubscribers:2,credentials:{}};return e.setConfig=function(i){return n=i,e},e.$get=function(){return n},e})}(),function(){var e=angular.module("osdOpentok");e.provider("PublisherConfig",function(){var e=this,n={width:200,height:150,name:"Me"};return e.setConfig=function(i){return n=i,e},e.$get=function(){return n},e})}(),function(){var e=angular.module("osdOpentok");e.provider("SubscriberConfig",function(){var e=this,n={width:200,height:150,name:"Me"};return e.setConfig=function(i){return n=i,e},e.$get=function(){return n},e})}(),function(){function e(e,n,i,s,t){e.config=t,e.publishingVideo=s.publishingVideo,e.isModerator=!0,e.showPublisherTile=!0,e.publisher=s,e.getStreamsAvailable=function(){return i.streamsAvailable},e.getSubscribers=function(){return i.subscribers},e.publishScreen=function(){n.publishScreen()},e.subscribe=function(s){if(!e.mediaAccessAllowed)return e.onAccessRequired(),void 0;if(e.isModerator)return i.subscribers.length>=t.maxSubscribers?(e.onSubscriberLimitReached(),void 0):(n.subscribe(s,!0),void 0)},e.switchFullscreen=function(e){i.switchFullscreen(e)},e.forceDisconnect=function(e){n.unsubscribe(e,!0),i.removeSubscriberByStream(e)},e.isBeingSubscribedTo=function(e){return i.subscribers.some(function(n){return n.session&&n.session.stream&&n.session.stream.id==e.id})},s.onAccessAllowed=function(){e.mediaAccessAllowed=!0,e.onMediaAccessAllowed(),e.$apply()},s.onAccessDenied=function(){e.mediaAccessAllowed=!1,e.onAccessDenied(),e.$apply()}}function n(){return{restrict:"E",replace:!0,templateUrl:"/templates/angular-osd-opentok.html",controller:"LiveConsultationCtrl",controllerAs:"liveCtrl",scope:{onAccessDenied:"&",onAccessRequired:"&",onSubscriberLimitReached:"&",onMediaAccessAllowed:"&"}}}e.$inject=["$scope","SessionManager","DataManager","Publisher","OpentokConfig"],angular.module("osdOpentok").directive("liveConsultation",n).controller("LiveConsultationCtrl",e)}(),function(){function e(e,n){var i=this;return i.subscribers=[],i.streamsAvailable=[],i.switchFullscreen=function(s){e(function(){n.isFullscreen=!1,i.subscribers.forEach(function(e){e.isFullscreen=!1}),s.isFullscreen=!0})},i.removeSubscriberByStream=function(e){i.subscribers=i.subscribers.filter(function(n){return n.session.stream&&n.session.stream.id!=e.id})},i.getStreamByConnection=function(e){var n=i.streamsAvailable.filter(function(n){return n.connection.id===e.id});return n.length?n[0]:null},i.removeStreamByConnection=function(e){var s=i.getStreamByConnection(e);s&&(i.removeSubscriberByStream(s),i.streamsAvailable=i.streamsAvailable.filter(function(e){return s.id!=e.id})),i.subscribers.length?i.switchFullscreen(i.subscribers[0]):n.isFullscreen=!0},i}e.$inject=["$timeout","Publisher"],angular.module("osdOpentok").service("DataManager",e)}(),function(){function e(e){var n=this;return n.onAccessAllowed=null,n.onAccessDenied=null,n.session=null,n.publishingVideo=!1,n.stream=null,n.isFullscreen=!0,n.divId="publisherDiv",n.options={width:this.isFullscreen?"100%":e.width+"px",height:this.isFullscreen?"100%":e.height+"px",publishVideo:!0,publishAudio:!0,insertMode:"append"},n.setSession=function(e){n.session=e,n.session.on({accessAllowed:n.onAccessAllowed,accessDenied:n.onAccessDenied})},n.toggleVideo=function(){return n.session?(n.session.publishVideo(!n.publishingVideo),n.publishingVideo=!n.publishingVideo,n.publishingVideo):void 0},n}e.$inject=["PublisherConfig"],angular.module("osdOpentok").factory("Publisher",e)}(),function(){function e(e,n,i,s,t){function r(){a.on({streamCreated:b,streamDestroyed:d,connectionDestroyed:p,signal:function(e){"signal:subscribe"==e.type&&g(e),"signal:disconnect"==e.type&&h(e)}})}function o(){var e=Math.max(document.documentElement.clientHeight,window.innerHeight||0),n=document.getElementById("opentokDiv");n.style.height=e-66+"px"}function c(){var e=new XMLHttpRequest;XMLHttpRequest.prototype=Object.getPrototypeOf(e)}function u(e){e&&console.log("Error: ",e)}var l=this,a=null;OT.setLogLevel(OT.DEBUG),l.init=function(){o(),c(),OT.registerScreenSharingExtension("chrome",s.screenshare.extensionId),a=OT.initSession(s.credentials.apiKey,s.credentials.sid,u),r(),l.publish()},l.publish=function(){a.connect(s.credentials.token,function(e){u(e),n.options.name=s.credentials.name,n.setSession(OT.initPublisher(n.divId,n.options,u)),a.publish(n.session,u)})},l.publishScreen=function(){OT.checkScreenSharingCapability(function(e){e.supported&&e.extensionRegistered!==!1?e.extensionInstalled===!1?alert("Please install the screen sharing extension and load this page over HTTPS."):l.publish():alert("This browser does not support screen sharing.")})},l.subscribe=function(s,r){var o=new i(t.subscribers.length+1);e(function(){n.isFullscreen=!1,t.subscribers.push(o)}),e(function(){o.session=a.subscribe(s,o.divId,o.options),r&&a.signal({type:"subscribe",to:s.connection})},100)},l.unsubscribe=function(e,n){n&&a.signal({type:"disconnect",to:e.connection}),a.unsubscribe(e)},l.forceDisconnect=function(e){1==a.capabilities.forceDisconnect&&(a.forceUnpublish(e),a.forceDisconnect(e))},l.isModerator=function(){return 1==a.capabilities.forceDisconnect};var b=function(n){e(function(){t.getStreamByConnection(n.stream.connection)||t.streamsAvailable.push(n.stream)})},d=function(n){e(function(){t.removeStreamByConnection(n.stream.connection)})},p=function(n){e(function(){t.removeStreamByConnection(n.connection)})},g=function(n){e(function(){l.subscribe(t.getStreamByConnection(n.from),!1)})},h=function(){e(function(){a.disconnect(),t.streamsAvailable=[],t.subscribers=[]})};return l}e.$inject=["$timeout","Publisher","Subscriber","OpentokConfig","DataManager"],angular.module("osdOpentok").service("SessionManager",e)}(),function(){function e(e){return function(n){var i=this;i.isFullscreen=1===n,i.session=null,i.count=n,i.divId="subscriber-"+n,i.options={width:i.isFullscreen?"100%":e.width+"px",height:i.isFullscreen?"100%":e.height+"px",subscribeToVideo:!0,subscribeToAudio:!0,insertMode:"replace"},i.getStyle=function(){var n=(-e.width+5)*i.count;return{width:i.isFullscreen?"100%":e.width+"px",height:i.isFullscreen?"100%":e.height+"px","margin-left":i.isFullscreen?0:n+"px"}},i.toggleVideo=function(){return i.session?(i.session.subscribeToVideo(!i.subscribingToVideo),i.subscribingToVideo=!i.subscribingToVideo,i.subscribingToVideo):void 0}}}e.$inject=["SubscriberConfig"],angular.module("osdOpentok").service("Subscriber",e)}();